<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ana Torres | Bio Links</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="background.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Integración ligera de petite-vue para reactividad sin build -->
    <script src="https://unpkg.com/petite-vue@0.4.1/dist/petite-vue.iife.js" defer></script>
    <!-- Librería de QR ligera -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" defer></script>
    <style>
        /* Animación para el modal */
        .modal {
            transition: opacity 0.3s ease;
            opacity: 0;
        }
        
        .modal.show {
            opacity: 1;
        }
        
        .modal-content {
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }
        
        .modal.show .modal-content {
            transform: scale(1);
        }
    </style>
</head>
<body v-scope="{ 
    dark: false,
    mounted() {
        this.dark = (localStorage.getItem('theme') === 'dark');
    },
    toggleTheme() {
        this.dark = !this.dark;
        localStorage.setItem('theme', this.dark ? 'dark' : 'light');
    }
}"
:class="dark ? 'dark-theme' : ''">
    <!-- Preloader -->
    <div class="preloader" id="preloader">
        <div class="preloader-spinner"></div>
    </div>
    
    <!-- Fondo animado alternativo (si el video falla) -->
    <div class="background-fallback"></div>
    <div class="background-pattern"></div>
    <div class="particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>
    
    <!-- Video de fondo optimizado -->
    <div class="video-background">
        <video autoplay muted loop playsinline preload="metadata" class="background-video" crossorigin="anonymous">
            <!-- Fuente local en WebM (si luego se descarga) -->
            <source src="videos/model-runway.webm" type="video/webm">
            <!-- Preferir video local si existe -->
            <source src="videos/model-runway.mp4" type="video/mp4">
            <!-- Fallback externo confiable (Archive.org) -->
            <source src="https://archive.org/download/FashionShow/Fashion_Show_Angkor_Dance_Troops_512kb.mp4" type="video/mp4">
            <!-- Fallback externo libre (Pixabay) -->
            <source src="https://cdn.pixabay.com/vimeo/328940682/runway-23434.mp4" type="video/mp4">
            <!-- Fallback para navegadores que no soportan video -->
            <img src="https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=1920&h=1080&fit=crop" alt="Modelaje background" loading="lazy">
        </video>
        <div class="video-overlay"></div>
    </div>
    
    <div class="theme-toggle" @click="toggleTheme">
        <i :class="['fas', dark ? 'fa-sun' : 'fa-moon']"></i>
    </div>
    <div class="share-toggle" @click="openQR" title="Compartir">
        <i class="fas fa-share-alt"></i>
    </div>
    
    <div class="premium-activator" title="Activar modo premium" style="display: none;">
        <i class="fas fa-key"></i>
    </div>
    
    <div class="profile-container">
        <div class="profile-header">
            <div class="profile-photo-container">
                <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=400&h=400&fit=crop&crop=face" alt="Foto de perfil" class="profile-photo" loading="lazy">
            </div>
            <h1>Ana Torres</h1>
            <p class="bio">Creadora de contenido y modelo. ¡Sígueme en todas mis redes!</p>
            
            <div class="social-icons">
                <a href="#" class="social-icon instagram trackable-link" data-platform="instagram" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                <a href="#" class="social-icon tiktok trackable-link" data-platform="tiktok" aria-label="TikTok"><i class="fab fa-tiktok"></i></a>
                <a href="#" class="social-icon youtube trackable-link" data-platform="youtube" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                <a href="#" class="social-icon twitter trackable-link" data-platform="twitter" aria-label="X"><img src="images/x-logo.svg" alt="X"></a>
            </div>
        </div>

        <div class="links-section">
            <a href="#" class="link-btn instagram-btn trackable-link" data-platform="instagram" target="_blank">
                <i class="fab fa-instagram"></i> Instagram
                <span class="link-description">Fotos y momentos especiales</span>
            </a>
            <a href="#" class="link-btn tiktok-btn trackable-link" data-platform="tiktok" target="_blank">
                <i class="fab fa-tiktok"></i> TikTok
                <span class="link-description">Videos cortos y tendencias</span>
            </a>
            <a href="#" class="link-btn youtube-btn trackable-link" data-platform="youtube" target="_blank">
                <i class="fab fa-youtube"></i> YouTube
                <span class="link-description">Vlogs y contenido exclusivo</span>
            </a>
            <a href="#" class="link-btn twitter-btn trackable-link" data-platform="twitter" target="_blank">
                <img src="images/x-logo.svg" alt="X"> X
                <span class="link-description">Noticias y actualizaciones</span>
            </a>
            <a href="#" class="link-btn facebook-btn trackable-link" data-platform="facebook" target="_blank">
                <i class="fab fa-facebook"></i> Facebook
                <span class="link-description">Comunidad y eventos</span>
            </a>
            <a href="#" class="link-btn onlyfans-btn trackable-link" data-platform="onlyfans" target="_blank">
                <i class="fas fa-lock"></i> OnlyFans
                <span class="link-description">Contenido premium</span>
            </a>
            <a href="#" class="link-btn whatsapp-btn trackable-link" data-platform="whatsapp" target="_blank">
                <i class="fab fa-whatsapp"></i> WhatsApp
                <span class="link-description">Contacto directo</span>
            </a>
            <a href="#" class="link-btn telegram-btn trackable-link" data-platform="telegram" target="_blank">
                <i class="fab fa-telegram"></i> Telegram
                <span class="link-description">Canal de noticias</span>
            </a>
        </div>
        
        <footer>
            <p>© 2023 Ana Torres | Todos los derechos reservados</p>
        </footer>
    </div>
    
    <!-- Panel de métricas en vivo -->
    <div class="stats-section" v-if="metricsReady">
        <h3>Métricas en vivo</h3>
        <div class="stats-header">
            <div class="stat-card">
                <div class="stat-value">{{ totalVisits }}</div>
                <div class="stat-label">Visitas totales</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ totalClicks }}</div>
                <div class="stat-label">Clics totales</div>
            </div>
        </div>
        <div class="referral-stats" v-if="topPlatforms.length">
            <div class="referral-item" v-for="item in topPlatforms" :key="item.platform">
                <span class="referral-source">{{ item.platform }}</span>
                <div class="referral-bar">
                    <div class="referral-progress" :style="{ width: item.percent + '%' }"></div>
                </div>
                <span class="click-count">{{ item.count }}</span>
            </div>
        </div>
    </div>

    <!-- Modal QR -->
    <div class="modal" :class="{ show: qrOpen }" @click.self="closeQR">
        <div class="modal-content">
            <h3>QR para compartir</h3>
            <div id="qrCanvas" style="display: flex; justify-content: center; padding: 10px;"></div>
            <div class="modal-actions" style="display:flex; gap:10px; justify-content:center; padding-bottom:10px;">
                <button class="link-btn" @click="downloadQR"><i class="fas fa-download"></i> Descargar</button>
                <button class="link-btn" @click="closeQR"><i class="fas fa-times"></i> Cerrar</button>
            </div>
        </div>
    </div>
    
    <script>
        // Activar petite-vue sobre los v-scope del documento
        document.addEventListener('DOMContentLoaded', () => {
            if (window.PetiteVue) {
                window.PetiteVue.createApp({
                    mounted() {
                        this.dark = (localStorage.getItem('theme') === 'dark');
                        this.refreshMetrics();
                        // Actualiza métricas en vivo cada 1s
                        this._timer = setInterval(() => this.refreshMetrics(), 1000);
                    },
                    unmounted() {
                        if (this._timer) clearInterval(this._timer);
                    },
                    dark: false,
                    qrOpen: false,
                    totalVisits: 0,
                    totalClicks: 0,
                    topPlatforms: [],
                    metricsReady: false,
                    toggleTheme() {
                        this.dark = !this.dark;
                        localStorage.setItem('theme', this.dark ? 'dark' : 'light');
                    },
                    refreshMetrics() {
                        const totalVisits = parseInt(localStorage.getItem('biolink_total_visits') || '0');
                        const totalClicks = parseInt(localStorage.getItem('biolink_total_clicks') || '0');
                        const clicksStore = JSON.parse(localStorage.getItem('biolink_clicks') || '{}');
                        const today = new Date().toDateString();
                        const todayClicks = clicksStore[today] || {};
                        const entries = Object.entries(todayClicks).map(([platform, count]) => ({ platform, count }));
                        const sum = entries.reduce((acc, e) => acc + e.count, 0) || 1;
                        const top = entries
                            .sort((a,b) => b.count - a.count)
                            .slice(0, 5)
                            .map(e => ({ ...e, percent: Math.round((e.count / sum) * 100) }));
                        this.totalVisits = totalVisits;
                        this.totalClicks = totalClicks;
                        this.topPlatforms = top;
                        this.metricsReady = true;
                    },
                    openQR() {
                        this.qrOpen = true;
                        setTimeout(() => {
                            const el = document.getElementById('qrCanvas');
                            if (el) {
                                el.innerHTML = '';
                                new QRCode(el, {
                                    text: window.location.href,
                                    width: 200,
                                    height: 200,
                                    colorDark : this.dark ? '#ffffff' : '#000000',
                                    colorLight : this.dark ? '#00000000' : '#ffffff'
                                });
                            }
                        }, 0);
                    },
                    closeQR() { this.qrOpen = false; },
                    downloadQR() {
                        const el = document.getElementById('qrCanvas');
                        if (!el) return;
                        const canvas = el.querySelector('canvas');
                        if (!canvas) return;
                        const url = canvas.toDataURL('image/png');
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'biolink-qr.png';
                        document.body.appendChild(a);
                        a.click();
                        a.remove();
                    }
                }).mount();
            }
        });
    </script>
    <script src="script.js"></script>
</body>
</html>